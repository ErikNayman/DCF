<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–°–æ–≤–µ—Ç –ú—É–¥—Ä–µ—Ü–æ–≤ (Secure)</title>
  <style>
    :root { --bg:#1e1e1e; --text:#e0e0e0; --card:#2d2d2d; --accent:#4CAF50; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; max-width: 1400px; margin: 0 auto; }
    .controls { background: var(--card); padding: 20px; border-radius: 10px; margin-bottom: 20px; }
    .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px; }
    .verdict-box { background: #252535; border: 1px solid #4a4a6a; padding: 20px; border-radius: 10px; }
    .card { background: var(--card); padding: 15px; border-radius: 8px; border-top: 4px solid #555; height: 100%; }
    .card h3 { margin-top: 0; color: #aaa; font-size: 0.9em; text-transform: uppercase; }
    textarea, select, input { width: 100%; background: #111; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 5px; box-sizing: border-box; }
    button { background: var(--accent); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px; }
    button:hover { opacity: 0.9; }
    button:disabled { background: #555; cursor: not-allowed; }
    .response-text { white-space: pre-wrap; font-size: 0.9em; line-height: 1.5; min-height: 100px; }
    .loading { color: #888; font-style: italic; animation: pulse 1.5s infinite; }
    @keyframes pulse { 0%{opacity:.5} 50%{opacity:1} 100%{opacity:.5} }
    .role-bull { border-color: #4CAF50; }
    .role-bear { border-color: #F44336; }
    .role-tech { border-color: #2196F3; }
    .row { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 10px; }
    small { color:#888; }
  </style>
</head>
<body>

<h1>üèõ –°–æ–≤–µ—Ç –ú—É–¥—Ä–µ—Ü–æ–≤ (Secure)</h1>

<div class="controls">
  <label>–í–æ–ø—Ä–æ—Å –°–æ–≤–µ—Ç—É:</label>
  <textarea id="userPrompt" rows="3" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ä–∏—Å–∫ –ø—Ä–æ–¥–∞–∂–∏ –ø—É—Ç–æ–≤ –Ω–∞ SPY –ø—Ä–∏ IV 12%"></textarea>

  <div class="row">
    <div>
      <label>–†–µ–∂–∏–º:</label>
      <select id="mode">
        <option value="options">Options</option>
        <option value="ticker">Ticker</option>
        <option value="macro">Macro</option>
        <option value="custom">Custom</option>
      </select>
      <small>–†–µ–∂–∏–º –≤–ª–∏—è–µ—Ç –Ω–∞ ‚Äú—Å—É–¥—å—é‚Äù –∏ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ —Ä–æ–ª–µ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.</small>
    </div>
    <div>
      <label>–£—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–æ–≥–æ—Å—Ç–∏ –∫—Ä–∏—Ç–∏–∫–∏ (Roast):</label>
      <select id="harshness">
        <option value="medium">Medium</option>
        <option value="hard">Hard</option>
        <option value="nuclear">Nuclear</option>
      </select>
      <small>–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —ç—Ç–æ –º–µ–Ω—è–µ—Ç ‚Äú—Ç–æ–Ω‚Äù –∫—Ä–∏—Ç–∏–∫–∏.</small>
    </div>
  </div>

  <button onclick="startCouncil()" id="runBtn">–°–æ–∑–≤–∞—Ç—å –°–æ–≤–µ—Ç</button>
  <div style="margin-top:8px;"><small>–ö–ª—é—á–µ–π –∑–¥–µ—Å—å –Ω–µ—Ç. –í—Å—ë –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ –≤–∞—à–µ–º backend.</small></div>
</div>

<div class="grid">
  <div class="card role-bull">
    <h3>üìà The Bull (–û–ø—Ç–∏–º–∏—Å—Ç)</h3>
    <div id="resp1" class="response-text">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
  </div>

  <div class="card role-bear">
    <h3>üìâ The Bear (–†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–µ—Ä)</h3>
    <div id="resp2" class="response-text">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
  </div>

  <div class="card role-tech">
    <h3>üíª The Quant (–¢–µ—Ö–Ω–∞—Ä—å)</h3>
    <div id="resp3" class="response-text">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
  </div>
</div>

<div class="verdict-box">
  <h3>‚öñÔ∏è –ò—Ç–æ–≥–æ–≤—ã–π –í–µ—Ä–¥–∏–∫—Ç (–ü—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—å)</h3>
  <div id="verdict" class="response-text">–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Å–∏–Ω—Ç–µ–∑ –º–Ω–µ–Ω–∏–π –ø–æ—Å–ª–µ –¥–µ–±–∞—Ç–æ–≤...</div>
</div>

<script>
  function setLoading() {
    document.getElementById('resp1').innerHTML = '<span class="loading">–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é...</span>';
    document.getElementById('resp2').innerHTML = '<span class="loading">–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é...</span>';
    document.getElementById('resp3').innerHTML = '<span class="loading">–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é...</span>';
    document.getElementById('verdict').innerHTML = '<span class="loading">–°—É–¥—å—è –ø–∏—à–µ—Ç –∑–∞–∫–ª—é—á–µ–Ω–∏–µ...</span>';
  }

  async function startCouncil() {
    const prompt = document.getElementById('userPrompt').value.trim();
    const mode = document.getElementById('mode').value;
    const harshness = document.getElementById('harshness').value;
    const btn = document.getElementById('runBtn');

    if (!prompt) { alert('–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å!'); return; }

    btn.disabled = true;
    btn.innerText = "–°–æ–≤–µ—Ç —Å–æ–≤–µ—â–∞–µ—Ç—Å—è...";
    setLoading();

    try {
      const res = await fetch("/api/council", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          prompt,
          mode,
          harshness,
          // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å: tickers, iv, horizon, constraints, etc.
        })
      });

      const data = await res.json();
      if (!res.ok) throw new Error(data?.detail || "–û—à–∏–±–∫–∞ backend");

      document.getElementById('resp1').innerText = data?.agents?.bull?.final || "‚Äî";
      document.getElementById('resp2').innerText = data?.agents?.bear?.final || "‚Äî";
      document.getElementById('resp3').innerText = data?.agents?.quant?.final || "‚Äî";
      document.getElementById('verdict').innerText = data?.verdict || "‚Äî";

    } catch (e) {
      document.getElementById('verdict').innerText = "–û—à–∏–±–∫–∞: " + e.message;
    } finally {
      btn.disabled = false;
      btn.innerText = "–°–æ–∑–≤–∞—Ç—å –°–æ–≤–µ—Ç";
    }
  }
</script>

</body>
</html>
