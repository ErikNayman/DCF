<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞—Ä–ø–∞—Ç–∏: –°–æ–≤–µ—Ç –ú—É–¥—Ä–µ—Ü–æ–≤ (Prototype)</title>
    <style>
        :root { --bg: #1e1e1e; --text: #e0e0e0; --card: #2d2d2d; --accent: #4CAF50; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; max-width: 1400px; margin: 0 auto; }
        
        /* Layout */
        .controls { background: var(--card); padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px; }
        .verdict-box { background: #252535; border: 1px solid #4a4a6a; padding: 20px; border-radius: 10px; }
        
        /* Elements */
        .card { background: var(--card); padding: 15px; border-radius: 8px; border-top: 4px solid #555; height: 100%; }
        .card h3 { margin-top: 0; color: #aaa; font-size: 0.9em; text-transform: uppercase; }
        textarea, input { width: 100%; background: #111; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 5px; box-sizing: border-box; }
        button { background: var(--accent); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        button:hover { opacity: 0.9; }
        button:disabled { background: #555; cursor: not-allowed; }
        
        /* Status & Loading */
        .response-text { white-space: pre-wrap; font-size: 0.9em; line-height: 1.5; min-height: 100px; }
        .loading { color: #888; font-style: italic; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
        
        .role-bull { border-color: #4CAF50; } /* –ó–µ–ª–µ–Ω—ã–π */
        .role-bear { border-color: #F44336; } /* –ö—Ä–∞—Å–Ω—ã–π */
        .role-tech { border-color: #2196F3; } /* –°–∏–Ω–∏–π */
    </style>
</head>
<body>

    <h1>üèõ –°–æ–≤–µ—Ç –ú—É–¥—Ä–µ—Ü–æ–≤ (–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ê–Ω–¥—Ä–µ—è –ö–∞—Ä–ø–∞—Ç–æ–≥–æ)</h1>

    <div class="controls">
        <div style="margin-bottom: 10px;">
            <label>OpenAI API Key:</label>
            <input type="password" id="apiKey" placeholder="sk-..." value="">
            <small style="color: #888;">–ö–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ.</small>
        </div>
        <div>
            <label>–í–æ–ø—Ä–æ—Å –°–æ–≤–µ—Ç—É:</label>
            <textarea id="userPrompt" rows="3" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°—Ç–æ–∏—Ç –ª–∏ —Å–µ–π—á–∞—Å –ø—Ä–æ–¥–∞–≤–∞—Ç—å –ø—É—Ç—ã –Ω–∞ SPY?"></textarea>
        </div>
        <button onclick="startCouncil()" id="runBtn">–°–æ–∑–≤–∞—Ç—å –°–æ–≤–µ—Ç</button>
    </div>

    <div class="grid">
        <div class="card role-bull">
            <h3>üìà The Bull (–û–ø—Ç–∏–º–∏—Å—Ç)</h3>
            <div id="resp1" class="response-text">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
        </div>

        <div class="card role-bear">
            <h3>üìâ The Bear (–†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–µ—Ä)</h3>
            <div id="resp2" class="response-text">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
        </div>

        <div class="card role-tech">
            <h3>üíª The Quant (–¢–µ—Ö–Ω–∞—Ä—å)</h3>
            <div id="resp3" class="response-text">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
        </div>
    </div>

    <div class="verdict-box">
        <h3>‚öñÔ∏è –ò—Ç–æ–≥–æ–≤—ã–π –í–µ—Ä–¥–∏–∫—Ç (–ü—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—å)</h3>
        <div id="verdict" class="response-text">–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Å–∏–Ω—Ç–µ–∑ –º–Ω–µ–Ω–∏–π –ø–æ—Å–ª–µ –¥–µ–±–∞—Ç–æ–≤...</div>
    </div>

<script>
    // –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–æ–ª–µ–π
    const roles = [
        { id: 'resp1', role: '–¢—ã –æ–ø—ã—Ç–Ω—ã–π –∏–Ω–≤–µ—Å—Ç–æ—Ä, –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –†–û–°–¢. –ò—â–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –ø—Ä–∏–±—ã–ª–∏. –ë—É–¥—å —É–±–µ–¥–∏—Ç–µ–ª–µ–Ω.' },
        { id: 'resp2', role: '–¢—ã —Å—Ç—Ä–æ–≥–∏–π –†–ò–°–ö-–ú–ï–ù–ï–î–ñ–ï–†. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞–π—Ç–∏ —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞, —É–≥—Ä–æ–∑—ã, –ø–µ—Ä–µ–æ—Ü–µ–Ω–µ–Ω–Ω–æ—Å—Ç—å –∏ —Ä–µ–≥—É–ª—è—Ç–æ—Ä–Ω—ã–µ —Ä–∏—Å–∫–∏. –ë—É–¥—å —Å–∫–µ–ø—Ç–∏—á–µ–Ω.' },
        { id: 'resp3', role: '–¢—ã QUANT-–∞–Ω–∞–ª–∏—Ç–∏–∫. –¢–µ–±—è –Ω–µ –≤–æ–ª–Ω—É—é—Ç —ç–º–æ—Ü–∏–∏, —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã, –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, –≥—Ä–µ–∫–∏ –æ–ø—Ü–∏–æ–Ω–æ–≤ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑. –ë—É–¥—å –∫—Ä–∞—Ç–æ–∫ –∏ —Ç–æ—á–µ–Ω.' }
    ];

    async function callLLM(apiKey, systemPrompt, userPrompt) {
        const url = "https://api.openai.com/v1/chat/completions";
        
        try {
            const response = await fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: "gpt-4o-mini", // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±—ã—Å—Ç—Ä—É—é –º–æ–¥–µ–ª—å –¥–ª—è —Ç–µ—Å—Ç–∞
                    messages: [
                        { role: "system", content: systemPrompt },
                        { role: "user", content: userPrompt }
                    ],
                    temperature: 0.7
                })
            });
            const data = await response.json();
            if (data.error) throw new Error(data.error.message);
            return data.choices[0].message.content;
        } catch (error) {
            return `–û—à–∏–±–∫–∞: ${error.message}`;
        }
    }

    async function startCouncil() {
        const key = document.getElementById('apiKey').value;
        const prompt = document.getElementById('userPrompt').value;
        const btn = document.getElementById('runBtn');
        
        if (!key) { alert('–í–≤–µ–¥–∏—Ç–µ API Key!'); return; }
        if (!prompt) { alert('–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å!'); return; }

        btn.disabled = true;
        btn.innerText = "–°–æ–≤–µ—Ç —Å–æ–≤–µ—â–∞–µ—Ç—Å—è...";
        
        // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π
        roles.forEach(r => document.getElementById(r.id).innerHTML = '<span class="loading">–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é...</span>');
        document.getElementById('verdict').innerHTML = '<span class="loading">–û–∂–∏–¥–∞–Ω–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤...</span>';

        // 1. –ü–ê–†–ê–õ–õ–ï–õ–¨–ù–´–ô –ó–ê–ü–£–°–ö 3 –ê–ì–ï–ù–¢–û–í
        const promises = roles.map(r => callLLM(key, r.role, prompt));
        
        // –ñ–¥–µ–º –≤—Å–µ—Ö —Ç—Ä–æ–∏—Ö
        const results = await Promise.all(promises);

        // –í—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        let combinedDebate = "";
        results.forEach((res, index) => {
            document.getElementById(roles[index].id).innerText = res;
            // –°–æ–±–∏—Ä–∞–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å—É–¥—å–∏
            combinedDebate += `\n[–ú–ù–ï–ù–ò–ï ${index+1}]: ${res}\n`;
        });

        // 2. –°–ò–ù–¢–ï–ó (–í–ï–†–î–ò–ö–¢)
        document.getElementById('verdict').innerHTML = '<span class="loading">–ü—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –∑–∞–∫–ª—é—á–µ–Ω–∏–µ...</span>';
        
        const judgeSystemPrompt = "–¢—ã –ü—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—å –°–æ–≤–µ—Ç–∞ –ú—É–¥—Ä–µ—Ü–æ–≤. –ü—Ä–æ—á–∏—Ç–∞–π –º–Ω–µ–Ω–∏—è —Ç—Ä–µ—Ö —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ (–ë—ã–∫–∞, –ú–µ–¥–≤–µ–¥—è –∏ –ö–≤–∞–Ω—Ç–∞). –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî —Å–∏–Ω—Ç–µ–∑–∏—Ä–æ–≤–∞—Ç—å –≤–∑–≤–µ—à–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ. –£–∫–∞–∂–∏, –≤ —á–µ–º —ç–∫—Å–ø–µ—Ä—Ç—ã —Å–æ–≥–ª–∞—Å–Ω—ã, –∞ –≥–¥–µ –µ—Å—Ç—å –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è. –î–∞–π —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é.";
        const judgePrompt = `–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "${prompt}".\n\n–í–æ—Ç –º–Ω–µ–Ω–∏—è —ç–∫—Å–ø–µ—Ä—Ç–æ–≤:\n${combinedDebate}`;

        const finalVerdict = await callLLM(key, judgeSystemPrompt, judgePrompt);
        document.getElementById('verdict').innerText = finalVerdict;

        btn.disabled = false;
        btn.innerText = "–°–æ–∑–≤–∞—Ç—å –°–æ–≤–µ—Ç";
    }
</script>

</body>
</html>
